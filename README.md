![Python Version](https://img.shields.io/pypi/pyversions/ie-viz)
![PyPI](https://img.shields.io/pypi/v/ie-viz)

Visualization tool for NLP information extraction: Named entity recognition, Entity attribute extraction, and Relation extration.

## Table of Contents
- [Overview](#overview)
- [Prerequisite](#prerequisite)
- [Installation](#installation)
- [Quick Start](#quick-start)
- [Examples](#examples)
- [User Guide](#user-guide)

## Overview
aaa

## Prerequisite
- python ^3.11
- flask >=2.3

## Installation
Python package is available on PyPi.
```cmd
pip install ie-viz
```

## Quick-start
We use a short sample News article synthesized by GPT-4o to demo this quick-start.

```Python
text = """On Monday, the tech giant, Innovia Corp, announced the launch of its new flagship smartphone, the Innovia XPro. The device, which comes in both 128GB and 256GB storage variants, is powered by the latest Octa-core Quantum processor and features a 6.5-inch AMOLED display. According to the CEO, Lisa Martin, this release marks a significant milestone for the company. The phone is expected to compete directly with the recent release from its rival, Nexon Technologies, which unveiled the Nexon Ultra series earlier this year."""
```

Entities have types: "organization", "person", and "product". Each type has unique attributes: 
- person: Role
- product: Specifications

```python
entities = [
            {'entity_id': '0', 'start': 28, 'end': 40, 'attr': {'Type': 'organization'}}, 
            {'entity_id': '1', 'start': 294, 'end': 305, 'attr': {'Type': 'person', 'Role': 'CEO'}}, 
            {'entity_id': '2', 'start': 99, 'end': 111, 'attr': {'Type': 'product', 'Specifications': '128GB, 256GB, Octa-core Quantum processor, 6.5-inch AMOLED display'}}, 
            {'entity_id': '3', 'start': 449, 'end': 467, 'attr': {'Type': 'organization'}},
            {'entity_id': '4', 'start': 488, 'end': 506, 'attr': {'Type': 'product'}}
           ]
```

Relations (optional) are listed as as entity id pairs.
```python
relations = [
             {'entity_1_id': '0', 'entity_2_id': '1'}, 
             {'entity_1_id': '0', 'entity_2_id': '2'}, 
             {'entity_1_id': '3', 'entity_2_id': '4'}
            ]
```

Using the ```serve()``` function, we can visualize the entities, attributes, and relations. The ```theme``` parameter supports light and dark modes. The ```color_attr_key``` parameter specifies that entity color is based on entity "Type" attribute. 
```python
from ie_viz import serve

serve(text, entities, relations, theme="light", color_attr_key="Type")
```

```html
<html>\n    <head>\n        <title>Named Entity Visualization</title>\n        <style>\n        /* Default (Light) Theme */\n:root {\n    --background-color: #ffffff;\n    --text-color: #000000;\n    --path-color: #000208;\n    --tooltip-background-color: #333333;\n}\n\n/* Dark Theme */\nbody.dark-theme {\n    --background-color: #1f1f1f;\n    --text-color: #ffffff;\n    --path-color: #9C27B0;\n    --tooltip-background-color: #444444;\n}\n\nbody {\n    background-color: var(--background-color);\n    color: var(--text-color);\n}\n\n.entity-mark {\n    padding-right: 0.3em;\n    padding-left: 0.3em;\n    padding-top: 0.05em;\n    padding-bottom: 0.05em;\n    margin: 0 0.1em;\n    line-height: 1;\n    border-radius: 0.35em;\n    background: linear-gradient(#3f87a6, #ebf8e1, #f69d3c);\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2); /* Subtle shadow */\n    transition: background-color 0.3s ease, color 0.3s ease; /* Smooth transition */\n} \n\n.entity-mark:hover {\n    background-color: #b2ebf2; /* Slightly darker cyan on hover */\n    color: #004d40; /* Darker text on hover */\n}\n\n.custom-tooltip {\n    position: absolute;\n    background-color: var(--tooltip-background-color);\n    color: #fff;\n    padding: 8px; /* Slightly larger padding */\n    border-radius: 8px; /* More rounded corners */\n    z-index: 3;\n    white-space: nowrap;\n    pointer-events: none;\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow */\n    transition: opacity 0.3s ease; /* Smooth transition for opacity */\n    opacity: 0.8; /* Slightly transparent */\n}\n\n#display-textbox {\n    width: 95%;\n    z-index: 1;\n    word-wrap: break-word; /* Break long words */\n    overflow-wrap: break-word; /* Ensure long words wrap */\n    white-space: normal; /* Allow normal word wrapping */\n    overflow-y: auto; /* Enable vertical scrolling if needed */\n    position: absolute;\n    line-height: 1.5;\n}\n\n#display-relation {\n    width: 95%;\n    position: absolute;\n    z-index: 2;\n    pointer-events: none; /* Make the SVG non-interactive */\n}\n\n.relation-path {\n    opacity: 0.6;\n\tstroke: var(--path-color);\n    stroke-width: 2; /* Set the stroke width */\n    fill: none; /* Ensure the path is not filled */\n}\n\n#display-textbox-container {\n    width: 100%;\n    height: 100%;\n}\n        </style>\n    </head>\n    <body>\n        <div id="display-textbox-container">\n            <div id="display-textbox"></div>\n            <svg id="display-relation"></svg>\n        </div>\n        <script type="text/javascript">\n            // Embed the data as JavaScript variables\n            const data = {"text": "\\nOn Monday, the tech giant, Innovia Corp, announced the launch of its new flagship smartphone, the Innovia XPro. The device, which comes in both 128GB and 256GB storage variants, is powered by the latest Octa-core Quantum processor and features a 6.5-inch AMOLED display. According to the CEO, Lisa Martin, this release marks a significant milestone for the company. The phone is expected to compete directly with the recent release from its rival, Nexon Technologies, which unveiled the Nexon Ultra series earlier this year.\\n", "entities": [{"entity_id": "0", "start": 28, "end": 40, "attr": {"Type": "organization"}, "color": "#1f77b4"}, {"entity_id": "1", "start": 294, "end": 305, "attr": {"Type": "person", "Role": "CEO"}, "color": "#ff7f0e"}, {"entity_id": "2", "start": 99, "end": 111, "attr": {"Type": "product", "Specifications": "128GB, 256GB, Octa-core Quantum processor, 6.5-inch AMOLED display"}, "color": "#2ca02c"}, {"entity_id": "3", "start": 449, "end": 467, "attr": {"Type": "organization"}, "color": "#1f77b4"}, {"entity_id": "4", "start": 488, "end": 506, "attr": {"Type": "product"}, "color": "#2ca02c"}], "theme": "light", "relations": [{"entity_1_id": "0", "entity_2_id": "1"}, {"entity_1_id": "0", "entity_2_id": "2"}, {"entity_1_id": "3", "entity_2_id": "4"}]};\n            \n            // Original JavaScript logic\n            function alineDisplayRelation(svg_padding_size) {\n    // Get the display-textbox (div) and display-relation (svg) elements\n    const textDiv = document.getElementById("display-textbox");\n    const svgContainer = document.getElementById("display-relation");\n    // Get dimensions of the display-textbox\n    const textDivRect = textDiv.getBoundingClientRect();\n    // Set dimensions of the SVG container\n    svgContainer.style.top = (textDivRect.top - svg_padding_size) + \'px\';\n    svgContainer.style.left = (textDivRect.left - svg_padding_size) + \'px\';\n    svgContainer.style.height = (textDivRect.height + 2*svg_padding_size) + \'px\';\n    svgContainer.style.width = (textDivRect.width + 2*svg_padding_size) + \'px\';\n}\n\nfunction updateEntities(text, entities) {\n    // Clear current display textbox\n    var textElement = document.getElementById("display-textbox");\n    textElement.innerHTML = \'\';\n\n    // If no entities\n    if (!entities || entities.length === 0) {\n        text.split(\'\\n\').forEach((line, index, array) => {\n            textElement.appendChild(document.createTextNode(line));\n            if (index < array.length - 1) {\n                textElement.appendChild(document.createElement("br"));\n            }\n        });\n        return null;\n    }\n\n    // Sort entities by start index\n    entities.forEach(ent => {\n        ent.start = parseInt(ent.start);\n        ent.end = parseInt(ent.end);\n    });\n    entities.sort((a, b) => a.start - b.start);\n\n    // Add entities to the display textbox\n    var lastIndex = 0;\n    entities.forEach(ent => {\n        // Add text before the entity\n        if (lastIndex < ent.start) {\n            var nonEntityText = text.substring(lastIndex, ent.start);\n            nonEntityText.split(\'\\n\').forEach((line, index, array) => {\n                textElement.appendChild(document.createTextNode(line));\n                if (index < array.length - 1) {\n                    textElement.appendChild(document.createElement("br"));\n                }\n            });\n        }\n\n        // Add the entity text\n        var entityText = text.substring(ent.start, ent.end);\n        var entityElement = document.createElement("mark");\n        entityElement.id = ent.entity_id;\n        entityElement.className = "entity-mark";\n        entityElement.textContent = entityText;\n        if (ent.color) {\n            entityElement.style.background = \'none\';\n            entityElement.style.backgroundColor = ent.color;\n        }\n        entityElement.addEventListener(\'mouseenter\', function(event) {\n            if (ent.attr) {\n                const prettyAttributes = JSON.stringify(ent.attr, null, 2).replace(/\\n/g, \'<br>\').replace(/  /g, \'&nbsp;&nbsp;\');\n                showTooltip(event, `Entity ID: ${ent.entity_id}<br>Text: ${entityText}<br>Attributes: ${prettyAttributes}`);\n            }\n            else {\n                showTooltip(event, `Entity ID: ${ent.entity_id}<br>Text: ${entityText}`);\n            }\n        });\n        entityElement.addEventListener(\'mouseleave\', function() {\n            hideTooltip();\n        });\n        textElement.appendChild(entityElement);\n\n        lastIndex = ent.end;\n    });\n\n    // Add remaining text after the last entity\n    if (lastIndex < text.length) {\n        var remainingText = text.substring(lastIndex);\n        remainingText.split(\'\\n\').forEach((line, index, array) => {\n            textElement.appendChild(document.createTextNode(line));\n            if (index < array.length - 1) {\n                textElement.appendChild(document.createElement("br"));\n            }\n        });\n    }\n}\n\nfunction showTooltip(event, content) {\n    // Remove any existing tooltip\n    var existingTooltip = document.getElementById("custom-tooltip");\n    if (existingTooltip) {\n        existingTooltip.remove();\n    }\n\n    // Create a new tooltip\n    var tooltip = document.createElement("div");\n    tooltip.id = "custom-tooltip";\n    tooltip.className = "custom-tooltip";\n    tooltip.innerHTML = content;\n    document.body.appendChild(tooltip); \n\n    // Position the tooltip\n    var rect = event.target.getBoundingClientRect();\n    var x = rect.left + window.scrollX;\n    // 15px above the entity\n    var y = rect.top + window.scrollY - tooltip.offsetHeight - 15; \n\n    // Ensure the tooltip doesn\'t go off-screen\n    if (x + tooltip.offsetWidth > window.innerWidth) {\n        // 10px padding from the right edge\n        x = window.innerWidth - tooltip.offsetWidth - 10; \n    }\n    if (y < 0) {\n        // 5px below the entity if it goes off-screen\n        y = rect.bottom + window.scrollY + 5; \n    }\n\n    tooltip.style.left = x + "px";\n    tooltip.style.top = y + "px";\n}\n\nfunction hideTooltip() {\n    var tooltip = document.getElementById("custom-tooltip");\n    if (tooltip) {\n        tooltip.remove();\n    }\n}\n\nfunction updateRelations(relations, r, svg_padding_size) {\n    /* \n    * Update the relation lines between entities \n    *\n    * relations: list of relation objects with entity_1_id and entity_2_id\n    * r: level size for the relation paths\n    * svg_padding_size: padding size for the svg container\n    */\n\n    // If no relations\n    if (!relations || relations.length === 0) {\n        return null;\n    }\n\n    // Get the display-textbox (div) and display-relation (svg) elements\n    const textDiv = document.getElementById("display-textbox");\n    const svgContainer = document.getElementById("display-relation");\n    const textDivRect = textDiv.getBoundingClientRect();\n\n    // Clear current relation lines\n    svgContainer.innerHTML = \'\';\n\n    relations.forEach(rel => {\n        const entity1Element = document.getElementById(rel.entity_1_id);\n        const entity2Element = document.getElementById(rel.entity_2_id);\n\n        // Check if elements exist\n        if (!entity1Element || !entity2Element) {\n            console.error(\'Entity elements not found:\', rel.entity_1_id, rel.entity_2_id);\n            return;\n        }\n\n        const entity1Rect = entity1Element.getBoundingClientRect();\n        const entity2Rect = entity2Element.getBoundingClientRect();\n\n        // Get the computed style of the entity elements to determine the line height\n        const entity1Style = window.getComputedStyle(entity1Element);\n        const entity2Style = window.getComputedStyle(entity2Element);\n        const entity1LineHeight = parseFloat(entity1Style.lineHeight);\n        const entity2LineHeight = parseFloat(entity2Style.lineHeight);\n\n        // Calculate the number of lines\n        const entity1Lines = entity1Rect.height / entity1LineHeight;\n        const entity2Lines = entity2Rect.height / entity2LineHeight;\n\n        // Handle line-broken entity\n        // When an entity is split by line change, we use the top-left as StartX\n        const entity1X = entity1Lines > 2 ? entity1Rect.right - textDivRect.left + svg_padding_size : entity1Rect.left + entity1Rect.width / 2 - textDivRect.left + svg_padding_size;\n        const entity1Y = entity1Rect.top - textDivRect.top + svg_padding_size;\n        const entity2X = entity2Lines > 2 ? entity2Rect.right - textDivRect.left + svg_padding_size : entity2Rect.left + entity2Rect.width / 2 - textDivRect.left + svg_padding_size;\n        const entity2Y = entity2Rect.top - textDivRect.top + svg_padding_size;\n\n        // start with entity on left\n        var startX = null;\n        var startY = null;\n        var endX = null;\n        var endY = null;\n        if (entity1X < entity2X) {\n            startX = entity1X;\n            startY = entity1Y;\n            endX = entity2X;\n            endY = entity2Y;\n        } else {\n            startX = entity2X;\n            startY = entity2Y;\n            endX = entity1X;\n            endY = entity1Y;\n        }\n\n        // Create the SVG path\n        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");\n        // If start and end entities are on the same y-axis\n        if (startY === endY) {\n            path.setAttribute("d", `M${startX} ${startY} a ${r} ${r} 0 0 1 ${r} -${r} L${endX - r} ${startY - r} a ${r} ${r} 0 0 1 ${r} ${r} L${endX} ${endY}`);\n        }\n        // If start entity is below end entities\n        else if (startY > endY) {\n            path.setAttribute("d", `M${startX} ${startY} L${startX} ${endY} a ${r} ${r} 0 0 1 ${r} -${r} L${endX - r} ${endY - r} a ${r} ${r} 0 0 1 ${r} ${r} L${endX} ${endY}`);\n        }\n        // If start entity is above end entities\n        else {\n            path.setAttribute("d", `M${startX} ${startY} a ${r} ${r} 0 0 1 ${r} -${r} L${endX - r} ${startY - r} a ${r} ${r} 0 0 1 ${r} ${r} L${endX} ${endY}`);\n        }\n        path.setAttribute("class", "relation-path");\n        svgContainer.appendChild(path);\n    });\n}\n\n// Global variables for relation lines\nlet relations = null;\nlet relationPathLevel = 5;\nlet svgPaddingSize = 20;\n\n// This function wait until an element is rendered\nconst checkElement = async selector => {\n    while ( document.getElementById(selector) === null) {\n        await new Promise( resolve =>  requestAnimationFrame(resolve) )\n    }\n    return document.getElementById(selector);\n};\n\nupdateEntities(data.text, data.entities);\n\nif (\'theme\' in data) {\n    if (data.theme === \'dark\') {\n        document.body.className = \'\';\n        document.body.classList.add(\'dark-theme\');\n    }\n}\n\nif (\'relations\' in data) {\n    relations = data.relations;\n    alineDisplayRelation(svgPaddingSize);\n    updateRelations(relations, relationPathLevel, svgPaddingSize);\n\n    // Add event listener for the main page scroll\n    window.addEventListener(\'scroll\', () => {\n        updateRelations(relations, relationPathLevel, svgPaddingSize);\n    });\n\n    // Add event listener for the main page resize\n    window.addEventListener(\'resize\', () => {\n        updateRelations(relations, relationPathLevel, svgPaddingSize);\n    });\n}\n\n\n        </script>\n    </body>\n    </html>
```